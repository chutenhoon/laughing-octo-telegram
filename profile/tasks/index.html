<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title data-i18n-key="profile.tasks.pageTitle">Nhi&#7879;m v&#7909; &#273;ang nh&#7853;n | polyflux.xyz</title>
    <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="../../android-chrome-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="../../android-chrome-512x512.png" />
    <link rel="manifest" href="../../site.webmanifest" />
    <link rel="icon" href="../../favicon.ico" />
    <meta name="description" content="S&#224;n th&#432;&#417;ng m&#7841;i &#273;i&#7879;n t&#7917; uy t&#237;n, giao nhanh, b&#7843;o h&#224;nh r&#245; r&#224;ng, h&#7895; tr&#7907; 24/7." />
    <meta property="og:title" content="polyflux.xyz" />
    <meta property="og:description" content="S&#224;n th&#432;&#417;ng m&#7841;i &#273;i&#7879;n t&#7917; uy t&#237;n, giao nhanh, b&#7843;o h&#224;nh r&#245; r&#224;ng, h&#7895; tr&#7907; 24/7." />
    <meta property="og:image" content="../../asset/logo-preview.png" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="vi_VN" />
    <meta property="og:site_name" content="polyflux.xyz" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="polyflux.xyz" />
    <meta name="twitter:description" content="S&#224;n th&#432;&#417;ng m&#7841;i &#273;i&#7879;n t&#7917; uy t&#237;n, giao nhanh, b&#7843;o h&#224;nh r&#245; r&#224;ng, h&#7895; tr&#7907; 24/7." />
    <meta name="twitter:image" content="../../asset/logo-preview.png" />
<link rel="stylesheet" href="../../asset/base.css" />
  </head>
  <body class="page-profile">
    <video class="video-bg" autoplay muted loop playsinline preload="metadata">
      <source src="../../asset/bg-donut.mp4" type="video/mp4" />
    </video>
    <div class="video-overlay"></div>

    <header class="wrap">
      <nav class="nav glass">
        <a href="/" class="brand" style="display: flex; align-items: center; gap: 12px; text-decoration: none;">
          <img src="../../asset/logo.png" alt="PolyFlux" />
          <span>polyflux<b>.xyz</b></span>
        </a>
        <div class="nav-links">
          <a href="/products/" data-nav="sanpham">S&#7843;n Ph&#7849;m <span class="badge">HOT</span></a>
          <a href="/dichvu/" data-nav="dichvu">D&#7883;ch V&#7909;</a>
          <a href="/nhiemvu/" data-nav="nhiemvu">Nhi&#7879;m V&#7909;</a>
          <a href="/profile/topups/" data-nav="topups">N&#7841;p ti&#7873;n</a>
        </div>
        <div class="nav-actions">
                    <button class="btn balance-btn" data-balance type="button">0 VND</button>
          <a class="btn login-btn" href="/login/">Login</a>
        </div>
      </nav>
    </header>

    <main class="wrap">
      <section class="hero">
        <h1 class="hero-title" data-i18n-key="profile.tasks.title">Nhi&#7879;m v&#7909; &#273;ang nh&#7853;n</h1>
        <p class="hero-sub" data-i18n-key="profile.tasks.subtitle">Theo d&#245;i c&#225;c nhi&#7879;m v&#7909; b&#7841;n &#273;&#227; nh&#7853;n v&#224; ti&#7871;n &#273;&#7897; duy&#7879;t.</p>
      </section>

      <section class="section">
        <div class="card">
          <h3 data-i18n-key="profile.tasks.sectionTitle">Danh s&#225;ch nhi&#7879;m v&#7909; &#273;ang nh&#7853;n</h3>
          <div class="table-like is-responsive task-table" id="profile-task-table">
            <div class="table-like-header">
              <span data-i18n-key="profile.tasks.table.task">Nhi&#7879;m v&#7909;</span>
              <span data-i18n-key="profile.tasks.table.receivedAt">Ng&#224;y nh&#7853;n</span>
              <span data-i18n-key="profile.tasks.table.deadline">H&#7871;t h&#7841;n</span>
              <span data-i18n-key="profile.tasks.table.reward">Th&#432;&#7903;ng</span>
              <span data-i18n-key="profile.tasks.table.status">Tr&#7841;ng th&#225;i</span>
            </div>
            <div id="profile-task-rows"></div>
            <div class="empty-state" id="profile-task-empty" style="margin-top: 10px;">
              <strong data-i18n-key="profile.tasks.emptyTitle">Ch&#432;a c&#243; nhi&#7879;m v&#7909; n&#224;o &#273;ang nh&#7853;n.</strong>
              <span data-i18n-key="profile.tasks.emptyDesc">Khi b&#7841;n nh&#7853;n nhi&#7879;m v&#7909; m&#7899;i, h&#7879; th&#7889;ng s&#7869; hi&#7875;n th&#7883; t&#7841;i &#273;&#226;y.</span>
            </div>
          </div>
        </div>
      </section>

      <footer>
        <div class="footer-grid">
          <div>
            <h4>About polyflux.xyz</h4>
            <p>
              The #1 trusted marketplace for digital assets on polyflux.xyz. Buy accounts, emails, tools and more with
              instant delivery.
            </p>
          </div>
          <div>
            <h4>&#272;i&#7873;u h&#432;&#7899;ng</h4>
            <p><a href="/products/">S&#7843;n ph&#7849;m</a></p>
            <p><a href="/dichvu/">D&#7883;ch v&#7909;</a></p>
            <p><a href="/nhiemvu/">Nhi&#7879;m v&#7909; marketplace</a></p>
            <p><a href="/profile/">T&#224;i kho&#7843;n c&#7911;a t&#244;i</a></p>
          </div>
          <div>
            <h4>Thanh to&#225;n &amp; b&#7843;o m&#7853;t</h4>
            <p>20+ ph&#432;&#417;ng th&#7913;c thanh to&#225;n, x&#7917; l&#253; t&#7921; &#273;&#7897;ng.</p>
            <p>L&#7883;ch s&#7917; &#273;&#417;n h&#224;ng minh b&#7841;ch.</p>
            <p>2FA &amp; c&#7843;nh b&#225;o &#273;&#259;ng nh&#7853;p kh&#7843; nghi.</p>
          </div>
          <div>
            <h4 data-task-cta-title>Xin quy&#7873;n &#273;&#259;ng b&#224;i</h4>
            <p data-task-cta-desc>B&#7841;n mu&#7889;n xin quy&#7873;n &#273;&#259;ng b&#224;i nhi&#7879;m v&#7909;?</p>
            <a
              href="/nhiemvu/tao/"
              class="btn primary"
              data-task-cta
              style="margin-top: 8px; display: inline-flex; align-items: center; gap: 6px;"
            >
              Xin quy&#7873;n &#273;&#259;ng b&#224;i
            </a>
          </div>
        </div>
      </footer>
    </main>

    <nav class="mobile-nav">
      <div class="mobile-nav-top">
        <a href="/" class="mobile-brand" style="display: flex; align-items: center; gap: 10px; text-decoration: none;">
          <img src="../../asset/logo.png" alt="PolyFlux" />
          <span>polyflux<b>.xyz</b></span>
        </a>
        <div class="mobile-actions">
                    <button class="btn balance-btn" data-balance type="button">0 VND</button>
          <a class="btn login-btn" href="/login/">Login</a>
        
          <button class="menu-btn" id="mobile-menu" type="button" aria-label="Menu">
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          </button>
        </div>
      </div>
      <div class="mobile-links">
        <a href="/products/" data-nav="sanpham">S&#7843;n Ph&#7849;m</a>
        <a href="/dichvu/" data-nav="dichvu">D&#7883;ch V&#7909;</a>
        <a href="/nhiemvu/" data-nav="nhiemvu">Nhi&#7879;m V&#7909;</a>
        <a href="/profile/topups/" data-nav="topups">N&#7841;p ti&#7873;n</a>
      </div>
    </nav>

    <script src="../../asset/render.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const table = document.getElementById("profile-task-table");
        const rows = document.getElementById("profile-task-rows");
        const empty = document.getElementById("profile-task-empty");
        if (!table || !rows) return;

        const auth = window.BKAuth ? window.BKAuth.read() : { loggedIn: false };
        const userId = window.BKTasks ? window.BKTasks.getUserId(auth) : "";

        const escapeHtml = (value) =>
          String(value || "").replace(/[&<>"']/g, (char) => {
            const map = { "&": "&amp;", "<": "&lt;", ">": "&gt;", "\"": "&quot;", "'": "&#39;" };
            return map[char] || char;
          });

        const formatDate = (value) => {
          if (!value) return "--";
          const date = new Date(value);
          if (Number.isNaN(date.getTime())) return "--";
          const dd = String(date.getDate()).padStart(2, "0");
          const mm = String(date.getMonth() + 1).padStart(2, "0");
          return `${dd}/${mm}/${date.getFullYear()}`;
        };

        const formatDateTime = (value) => {
          if (!value) return "--";
          const date = new Date(value);
          if (Number.isNaN(date.getTime())) return "--";
          const dd = String(date.getDate()).padStart(2, "0");
          const mm = String(date.getMonth() + 1).padStart(2, "0");
          const hh = String(date.getHours()).padStart(2, "0");
          const min = String(date.getMinutes()).padStart(2, "0");
          return `${dd}/${mm}/${date.getFullYear()} ${hh}:${min}`;
        };

        const getStatusMeta = (item, now) => {
          const status = String(item.status || "");
          if (status === "submitted") {
            const remain = Number(item.reviewDueAt || 0) - now;
            return { label: `Ch\u1edd duy\u1ec7t ${formatCountdown(remain)}`, tone: "warn" };
          }
          if (status === "redo") return { label: "Y\u00eau c\u1ea7u l\u00e0m l\u1ea1i", tone: "warn" };
          if (status === "approved") return { label: "\u0110\u00e3 duy\u1ec7t", tone: "good" };
          if (status === "auto_approved") return { label: "T\u1ef1 \u0111\u1ed9ng duy\u1ec7t", tone: "good" };
          if (status === "expired") return { label: "H\u1ebft h\u1ea1n", tone: "bad" };
          return { label: "\u0110ang l\u00e0m", tone: "warn" };
        };

        const formatCountdown = (ms) =>
          window.BKTasks && typeof window.BKTasks.formatCountdown === "function" ? window.BKTasks.formatCountdown(ms) : "--:--:--";

        let assignments = [];
        let visibleAssignments = [];

        const renderRows = () => {
          const now = Date.now();
          assignments = window.BKTasks ? window.BKTasks.syncAssignments(window.BKTasks.readAssignments()) : [];
          visibleAssignments = userId ? assignments.filter((item) => item && item.assigneeId === userId) : [];

          if (!visibleAssignments.length) {
            rows.innerHTML = "";
            if (empty) empty.style.display = "grid";
            return;
          }
          if (empty) empty.style.display = "none";
          rows.innerHTML = visibleAssignments
            .map((item) => {
              const taskTitle = escapeHtml(item.taskTitle || item.title || "Nhiem vu");
              const acceptedAt = item.acceptedAt ? formatDateTime(item.acceptedAt) : "--";
              const deadlineAt = Number(item.deadlineAt || 0);
              const deadlineText = deadlineAt ? formatCountdown(deadlineAt - now) : "--:--:--";
              const reward = typeof formatPrice === "function" ? formatPrice(Number(item.taskReward || item.reward || 0)) : `${item.taskReward || 0} VND`;
              const statusMeta = getStatusMeta(item, now);
              return `
                <div class="table-like-row" data-task-row>
                  <div data-label="Nhiem vu">${taskTitle}</div>
                  <div data-label="Ngay nhan">${acceptedAt}</div>
                  <div data-label="Het han" data-countdown="deadline" data-deadline="${deadlineAt}">${deadlineText}</div>
                  <div data-label="Thuong">${reward}</div>
                  <div data-label="Trang thai"><span class="badge-soft ${statusMeta.tone}">${statusMeta.label}</span></div>
                </div>
              `;
            })
            .join("");
        };

        const updateCountdowns = () => {
          const now = Date.now();
          document.querySelectorAll("[data-countdown=\"deadline\"]").forEach((el) => {
            const deadline = Number(el.dataset.deadline || 0);
            if (!deadline) return;
            el.textContent = formatCountdown(deadline - now);
          });
          document.querySelectorAll("[data-task-row]").forEach((row, index) => {
            const statusEl = row.querySelector(".badge-soft");
            if (!statusEl) return;
            const statusText = statusEl.textContent || "";
            if (!statusText.toLowerCase().includes("cho duyet")) return;
            const item = visibleAssignments[index];
            if (!item) return;
            const remain = Number(item.reviewDueAt || 0) - now;
            statusEl.textContent = `Ch\u1edd duy\u1ec7t ${formatCountdown(remain)}`;
          });
        };

        renderRows();
        updateCountdowns();
        setInterval(updateCountdowns, 1000);

        window.addEventListener("storage", (event) => {
          if (event.key === (window.BKTasks ? window.BKTasks.assignKey : "")) {
            renderRows();
          }
        });
      });
    </script>
  </body>
</html>





