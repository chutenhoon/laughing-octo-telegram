<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>&#272;&#259;ng k&#253; | polyflux.xyz</title>
    <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="192x192" href="../android-chrome-192x192.png" />
    <link rel="icon" type="image/png" sizes="512x512" href="../android-chrome-512x512.png" />
    <link rel="manifest" href="../site.webmanifest" />
    <link rel="icon" href="../favicon.ico" />
    <meta name="description" content="S&#224;n th&#432;&#417;ng m&#7841;i &#273;i&#7879;n t&#7917; uy t&#237;n, giao nhanh, b&#7843;o h&#224;nh r&#245; r&#224;ng, h&#7895; tr&#7907; 24/7." />
    <meta property="og:title" content="polyflux.xyz" />
    <meta property="og:description" content="S&#224;n th&#432;&#417;ng m&#7841;i &#273;i&#7879;n t&#7917; uy t&#237;n, giao nhanh, b&#7843;o h&#224;nh r&#245; r&#224;ng, h&#7895; tr&#7907; 24/7." />
    <meta property="og:image" content="../asset/logo-preview.png" />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="vi_VN" />
    <meta property="og:site_name" content="polyflux.xyz" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="polyflux.xyz" />
    <meta name="twitter:description" content="S&#224;n th&#432;&#417;ng m&#7841;i &#273;i&#7879;n t&#7917; uy t&#237;n, giao nhanh, b&#7843;o h&#224;nh r&#245; r&#224;ng, h&#7895; tr&#7907; 24/7." />
    <meta name="twitter:image" content="../asset/logo-preview.png" />
<link rel="stylesheet" href="../asset/base.css" />
  </head>
  <body>
    <video class="video-bg" autoplay muted loop playsinline>
      <source src="../asset/bg-donut.mp4" type="video/mp4" />
    </video>
    <div class="video-overlay"></div>

    <header class="wrap">
      <nav class="nav glass">
        <a href="/" class="brand" style="display: flex; align-items: center; gap: 12px; text-decoration: none;">
          <img src="../asset/logo.png" alt="PolyFlux" />
          <span>polyflux<b>.xyz</b></span>
        </a>
        <div class="nav-links">
          <a href="/sanpham/" data-nav="sanpham">S&#7843;n Ph&#7849;m <span class="badge">HOT</span></a>
          <a href="/dichvu/" data-nav="dichvu">D&#7883;ch V&#7909;</a>
          <a href="/nhiemvu/" data-nav="nhiemvu">Nhi&#7879;m V&#7909;</a>
          <a href="/profile/topups/" data-nav="topups">N&#7841;p ti&#7873;n</a>
        </div>
        <div class="nav-actions">
                    <button class="btn balance-btn" data-balance type="button">0 VND</button>
          <a class="btn login-btn" href="/login/">Login</a>
        </div>
      </nav>
    </header>

    <main class="wrap">
      <section class="section">
        <div class="card" style="max-width: 540px; margin: 60px auto 0;">
          <h3>&#272;&#259;ng k&#253; t&#224;i kho&#7843;n</h3>
          <div class="form-grid">
            <div class="form-field">
              <label for="reg-name">H&#7885; v&#224; t&#234;n</label>
              <input id="reg-name" placeholder="VD: Nguyen Van A" />
            </div>
            <div class="form-field">
              <label for="reg-username">Username</label>
              <input id="reg-username" placeholder="username" autocomplete="username" />
            </div>
            <div class="form-field">
              <label for="reg-email">Email</label>
              <input id="reg-email" placeholder="you@example.com" autocomplete="email" />
            </div>
            <div class="form-field">
              <label for="reg-password">M&#7853;t kh&#7849;u</label>
              <input id="reg-password" type="password" autocomplete="new-password" />
            </div>
            <div class="form-field">
              <label for="reg-confirm">X&#225;c nh&#7853;n m&#7853;t kh&#7849;u</label>
              <input id="reg-confirm" type="password" autocomplete="new-password" />
            </div>
            <div class="form-field inline">
              <label>
                <input id="reg-terms" type="checkbox" />
                <span>T&#244;i &#273;&#227; &#273;&#7885;c v&#224; &#273;&#7891;ng &#253; v&#7899;i &#273;i&#7873;u kho&#7843;n s&#7917; d&#7909;ng</span>
              </label>
            </div>
            <button class="btn primary" id="register-submit" type="button">&#272;&#259;ng k&#253;</button>
            <div class="empty-state">
              <strong>L&#432;u &#253;:</strong> Vui l&#242;ng ki&#7875;m tra th&#244;ng tin tr&#432;&#7899;c khi g&#7917;i &#273;&#259;ng k&#253;.
            </div>
            <div class="form-field">
              <span class="hero-sub">&#272;&#227; c&#243; t&#224;i kho&#7843;n? <a href="/login/">&#272;&#259;ng nh&#7853;p</a></span>
            </div>
          </div>
        </div>
      </section>

      <footer>
        <div class="footer-grid">
          <div>
            <h4>About polyflux.xyz</h4>
            <p>
              The #1 trusted marketplace for digital assets on polyflux.xyz. Buy accounts, emails, tools and more with
              instant delivery.
            </p>
          </div>
          <div>
            <h4>&#272;i&#7873;u h&#432;&#7899;ng</h4>
            <p><a href="/sanpham/">S&#7843;n ph&#7849;m</a></p>
            <p><a href="/dichvu/">D&#7883;ch v&#7909;</a></p>
            <p><a href="/nhiemvu/">Nhi&#7879;m v&#7909; marketplace</a></p>
            <p><a href="/profile/">T&#224;i kho&#7843;n c&#7911;a t&#244;i</a></p>
          </div>
          <div>
            <h4>Thanh to&#225;n &amp; b&#7843;o m&#7853;t</h4>
            <p>20+ ph&#432;&#417;ng th&#7913;c thanh to&#225;n, x&#7917; l&#253; t&#7921; &#273;&#7897;ng.</p>
            <p>L&#7883;ch s&#7917; &#273;&#417;n h&#224;ng minh b&#7841;ch.</p>
            <p>2FA &amp; c&#7843;nh b&#225;o &#273;&#259;ng nh&#7853;p kh&#7843; nghi.</p>
          </div>
          <div>
            <h4>Tham gia b&#225;n h&#224;ng</h4>
            <p>Mu&#7889;n m&#7903; gian h&#224;ng tr&#234;n polyflux.xyz?</p>
            <a href="/seller/join/" class="btn primary" style="margin-top: 8px; display: inline-flex; align-items: center; gap: 6px;">
              Tham gia b&#225;n h&#224;ng
            </a>
          </div>
        </div>
      </footer>
    </main>

    <nav class="mobile-nav">
      <div class="mobile-nav-top">
        <a href="/" class="mobile-brand" style="display: flex; align-items: center; gap: 10px; text-decoration: none;">
          <img src="../asset/logo.png" alt="PolyFlux" />
          <span>polyflux<b>.xyz</b></span>
        </a>
        <div class="mobile-actions">
                    <button class="btn balance-btn" data-balance type="button">0 VND</button>
          <a class="btn login-btn" href="/login/">Login</a>
        
          <button class="menu-btn" id="mobile-menu" type="button" aria-label="Menu">
            <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          </button>
        </div>
      </div>
      <div class="mobile-links">
        <a href="/sanpham/" data-nav="sanpham">S&#7843;n Ph&#7849;m</a>
        <a href="/dichvu/" data-nav="dichvu">D&#7883;ch V&#7909;</a>
        <a href="/nhiemvu/" data-nav="nhiemvu">Nhi&#7879;m V&#7909;</a>
        <a href="/profile/topups/" data-nav="topups">N&#7841;p ti&#7873;n</a>
      </div>
    </nav>

    <script src="../asset/render.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const nameInput = document.getElementById("reg-name");
        if (nameInput && typeof sanitizeUsername === "function") {
          nameInput.addEventListener("input", () => {
            const next = sanitizeUsername(nameInput.value, "");
            if (nameInput.value !== next) {
              nameInput.value = next;
            }
          });
        }

        const registerBtn = document.getElementById("register-submit");
        if (!registerBtn) return;
        const usernameInput = document.getElementById("reg-username");
        const emailInput = document.getElementById("reg-email");
        const passwordInput = document.getElementById("reg-password");
        const confirmInput = document.getElementById("reg-confirm");
        const termsInput = document.getElementById("reg-terms");
        const normalizeUsernameInput = (value) =>
          String(value || "")
            .toLowerCase()
            .replace(/[^a-z0-9._-]/g, "")
            .slice(0, 20);

        if (usernameInput) {
          usernameInput.addEventListener("input", () => {
            const next = normalizeUsernameInput(usernameInput.value);
            if (usernameInput.value !== next) {
              usernameInput.value = next;
            }
          });
        }

        const showError = (message) => {
          if (!message) return;
          if (window.BKAuth && typeof window.BKAuth.showToast === "function") {
            window.BKAuth.showToast(message);
            return;
          }
          window.alert(message);
        };

        const resolveRegisterError = (code) => {
          switch (code) {
            case "NAME_REQUIRED":
              return "Name is required.";
            case "INVALID_EMAIL":
              return "Please enter a valid email address.";
            case "PASSWORD_TOO_SHORT":
              return "Password is too short.";
            case "PASSWORD_MISMATCH":
              return "Passwords do not match.";
            case "TERMS_REQUIRED":
              return "You must accept the terms to continue.";
            case "EMAIL_EXISTS":
              return "Email already exists. Please use a different email.";
            case "USERNAME_EXISTS":
              return "Username already exists. Please use a different username.";
            case "USERNAME_REQUIRED":
              return "Username is required.";
            case "INVALID_USERNAME":
              return "Username must be 3-20 chars, lowercase letters/numbers and . _ - only.";
            default:
              return "Registration failed. Please try again.";
          }
        };

        const handleRegister = () => {
          const name = nameInput && nameInput.value ? nameInput.value.trim() : "";
          const username = usernameInput && usernameInput.value ? normalizeUsernameInput(usernameInput.value) : "";
          const email = emailInput && emailInput.value ? emailInput.value.trim() : "";
          const password = passwordInput && passwordInput.value ? passwordInput.value : "";
          const confirm = confirmInput && confirmInput.value ? confirmInput.value : "";
          const termsAccepted = Boolean(termsInput && termsInput.checked);
          const usernamePattern = /^[a-z0-9._-]{3,20}$/;

          if (!name) {
            showError("Name is required.");
            return;
          }
          if (!username) {
            showError("Username is required.");
            return;
          }
          if (!usernamePattern.test(username)) {
            showError("Username must be 3-20 chars, lowercase letters/numbers and . _ - only.");
            return;
          }
          if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
            showError("Please enter a valid email address.");
            return;
          }
          if (!password) {
            showError("Password is required.");
            return;
          }
          if (password !== confirm) {
            showError("Passwords do not match.");
            return;
          }
          if (!termsAccepted) {
            showError("You must accept the terms to continue.");
            return;
          }

          registerBtn.disabled = true;
          registerBtn.setAttribute("aria-busy", "true");
          fetch("/api/auth/register", {
            method: "POST",
            headers: {
              "content-type": "application/json",
            },
            body: JSON.stringify({
              name,
              username,
              email,
              password,
              confirm,
              terms: termsAccepted,
            }),
          })
            .then(async (response) => {
              const data = await response.json().catch(() => null);
              if (!response.ok || !data || !data.ok) {
                showError(resolveRegisterError(data && data.error));
                return;
              }
              if (window.BKAuth && typeof window.BKAuth.getLoginUrl === "function") {
                window.location.href = window.BKAuth.getLoginUrl();
                return;
              }
              window.location.href = "/login/";
            })
            .catch(() => {
              showError("Registration failed. Please try again.");
            })
            .finally(() => {
              registerBtn.disabled = false;
              registerBtn.removeAttribute("aria-busy");
            });
        };

        registerBtn.addEventListener("click", handleRegister);
      });
    </script>
  </body>
</html>



